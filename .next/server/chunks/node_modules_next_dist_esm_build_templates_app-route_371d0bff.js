module.exports=[61378,e=>{"use strict";var t,n,s,o,i,a,r,l,c,d,u,h,f,p,g,E,m,C,y,O,R,_,w,I,A=e.i(47909),T=e.i(74017),v=e.i(96250),N=e.i(59756),S=e.i(61916),b=e.i(14444),D=e.i(37092),M=e.i(69741),x=e.i(16795),U=e.i(87718),P=e.i(95169),$=e.i(47587),G=e.i(66012),H=e.i(70101),L=e.i(74838),B=e.i(10372),F=e.i(93695);e.i(52474);var j=e.i(220),k=e.i(89171);(t=f||(f={})).STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object",(n=p||(p={})).LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python",(s=g||(g={})).OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded";let q=["user","model","function","system"];(o=E||(E={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",(i=m||(m={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",(a=C||(C={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",a.NEGLIGIBLE="NEGLIGIBLE",a.LOW="LOW",a.MEDIUM="MEDIUM",a.HIGH="HIGH",(r=y||(y={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER",(l=O||(O={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",l.STOP="STOP",l.MAX_TOKENS="MAX_TOKENS",l.SAFETY="SAFETY",l.RECITATION="RECITATION",l.LANGUAGE="LANGUAGE",l.BLOCKLIST="BLOCKLIST",l.PROHIBITED_CONTENT="PROHIBITED_CONTENT",l.SPII="SPII",l.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",l.OTHER="OTHER",(c=R||(R={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",c.RETRIEVAL_QUERY="RETRIEVAL_QUERY",c.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",c.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",c.CLASSIFICATION="CLASSIFICATION",c.CLUSTERING="CLUSTERING",(d=_||(_={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",d.AUTO="AUTO",d.ANY="ANY",d.NONE="NONE",(u=w||(w={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",u.MODE_DYNAMIC="MODE_DYNAMIC";class K extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class Y extends K{constructor(e,t){super(e),this.response=t}}class V extends K{constructor(e,t,n,s){super(e),this.status=t,this.statusText=n,this.errorDetails=s}}class X extends K{}class J extends K{}(h=I||(I={})).GENERATE_CONTENT="generateContent",h.STREAM_GENERATE_CONTENT="streamGenerateContent",h.COUNT_TOKENS="countTokens",h.EMBED_CONTENT="embedContent",h.BATCH_EMBED_CONTENTS="batchEmbedContents";class W{constructor(e,t,n,s,o){this.model=e,this.task=t,this.apiKey=n,this.stream=s,this.requestOptions=o}toString(){var e,t;let n=(null==(e=this.requestOptions)?void 0:e.apiVersion)||"v1beta",s=(null==(t=this.requestOptions)?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",o=`${s}/${n}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}async function Q(e){var t,n;let s,o=new Headers;o.append("Content-Type","application/json"),o.append("x-goog-api-client",(n=e.requestOptions,s=[],(null==n?void 0:n.apiClient)&&s.push(n.apiClient),s.push("genai-js/0.24.1"),s.join(" "))),o.append("x-goog-api-key",e.apiKey);let i=null==(t=e.requestOptions)?void 0:t.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(e){throw new X(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${e.message}`)}for(let[e,t]of i.entries()){if("x-goog-api-key"===e)throw new X(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new X(`Header name ${e} can only be set using the apiClient field`);o.append(e,t)}}return o}async function z(e,t,n,s,o,i){let a=new W(e,t,n,s,i);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}(i)),{method:"POST",headers:await Q(a),body:o})}}async function Z(e,t,n,s,o,i={},a=fetch){let{url:r,fetchOptions:l}=await z(e,t,n,s,o,i);return ee(r,l,a)}async function ee(e,t,n=fetch){let s;try{s=await n(e,t)}catch(n){var o=n,i=e;let t=o;throw"AbortError"===t.name?(t=new J(`Request aborted when fetching ${i.toString()}: ${o.message}`)).stack=o.stack:o instanceof V||o instanceof X||((t=new K(`Error fetching from ${i.toString()}: ${o.message}`)).stack=o.stack),t}return s.ok||await et(s,e),s}async function et(e,t){let n,s="";try{let t=await e.json();s=t.error.message,t.error.details&&(s+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(e){}throw new V(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${s}`,e.status,e.statusText,n)}function en(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ei(e.candidates[0]))throw new Y(`${ea(e)}`,e);return function(e){var t,n,s,o;let i=[];if(null==(n=null==(t=e.candidates)?void 0:t[0].content)?void 0:n.parts)for(let t of null==(o=null==(s=e.candidates)?void 0:s[0].content)?void 0:o.parts)t.text&&i.push(t.text),t.executableCode&&i.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&i.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}(e)}if(e.promptFeedback)throw new Y(`Text not available. ${ea(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ei(e.candidates[0]))throw new Y(`${ea(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),es(e)[0]}if(e.promptFeedback)throw new Y(`Function call not available. ${ea(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ei(e.candidates[0]))throw new Y(`${ea(e)}`,e);return es(e)}if(e.promptFeedback)throw new Y(`Function call not available. ${ea(e)}`,e)},e}function es(e){var t,n,s,o;let i=[];if(null==(n=null==(t=e.candidates)?void 0:t[0].content)?void 0:n.parts)for(let t of null==(o=null==(s=e.candidates)?void 0:s[0].content)?void 0:o.parts)t.functionCall&&i.push(t.functionCall);return i.length>0?i:void 0}let eo=[O.RECITATION,O.SAFETY,O.LANGUAGE];function ei(e){return!!e.finishReason&&eo.includes(e.finishReason)}function ea(e){var t,n,s;let o="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)o+="Response was blocked",(null==(t=e.promptFeedback)?void 0:t.blockReason)&&(o+=` due to ${e.promptFeedback.blockReason}`),(null==(n=e.promptFeedback)?void 0:n.blockReasonMessage)&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null==(s=e.candidates)?void 0:s[0]){let t=e.candidates[0];ei(t)&&(o+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(o+=`: ${t.finishMessage}`))}return o}function er(e){return this instanceof er?(this.v=e,this):new er(e)}"function"==typeof SuppressedError&&SuppressedError;let el=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function ec(e){let t=[],n=e.getReader();for(;;){let{done:e,value:s}=await n.read();if(e)return en(function(e){let t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates){let e=0;for(let s of t.candidates)if(n.candidates||(n.candidates=[]),n.candidates[e]||(n.candidates[e]={index:e}),n.candidates[e].citationMetadata=s.citationMetadata,n.candidates[e].groundingMetadata=s.groundingMetadata,n.candidates[e].finishReason=s.finishReason,n.candidates[e].finishMessage=s.finishMessage,n.candidates[e].safetyRatings=s.safetyRatings,s.content&&s.content.parts){n.candidates[e].content||(n.candidates[e].content={role:s.content.role||"user",parts:[]});let t={};for(let o of s.content.parts)o.text&&(t.text=o.text),o.functionCall&&(t.functionCall=o.functionCall),o.executableCode&&(t.executableCode=o.executableCode),o.codeExecutionResult&&(t.codeExecutionResult=o.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),n.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(n.usageMetadata=t.usageMetadata)}return n}(t));t.push(s)}}async function ed(e,t,n,s){return function(e){let t,[n,s]=(t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})).getReader(),new ReadableStream({start(e){let n="";return function s(){return t.read().then(({value:t,done:o})=>{let i;if(o)return n.trim()?void e.error(new K("Failed to parse stream")):void e.close();let a=(n+=t).match(el);for(;a;){try{i=JSON.parse(a[1])}catch(t){e.error(new K(`Error parsing JSON response: "${a[1]}"`));return}e.enqueue(i),a=(n=n.substring(a[0].length)).match(el)}return s()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new J("Request aborted when reading from the stream"):new K("Error reading from the stream")})}()}})).tee();return{stream:function(e){return function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,o=n.apply(e,t||[]),i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(e){o[e]&&(s[e]=function(t){return new Promise(function(n,s){i.push([e,t,n,s])>1||r(e,t)})})}function r(e,t){try{var n;(n=o[e](t)).value instanceof er?Promise.resolve(n.value.v).then(l,c):d(i[0][2],n)}catch(e){d(i[0][3],e)}}function l(e){r("next",e)}function c(e){r("throw",e)}function d(e,t){e(t),i.shift(),i.length&&r(i[0][0],i[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:n}=yield er(t.read());if(n)break;yield yield er(en(e))}})}(n),response:ec(s)}}(await Z(t,I.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),s))}async function eu(e,t,n,s){let o=await Z(t,I.GENERATE_CONTENT,e,!1,JSON.stringify(n),s);return{response:en(await o.json())}}function eh(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)if(!e.role)return{role:"system",parts:e.parts};else return e}}function ef(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let n of e)"string"==typeof n?t.push({text:n}):t.push(n);var n=t;let s={role:"user",parts:[]},o={role:"function",parts:[]},i=!1,a=!1;for(let e of n)"functionResponse"in e?(o.parts.push(e),a=!0):(s.parts.push(e),i=!0);if(i&&a)throw new K("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!a)throw new K("No content is provided for sending chat message.");return i?s:o}function ep(e){let t;return t=e.contents?e:{contents:[ef(e)]},e.systemInstruction&&(t.systemInstruction=eh(e.systemInstruction)),t}let eg=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],eE={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function em(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;let n=null==(t=e.candidates[0])?void 0:t.content;if(void 0===n||void 0===n.parts||0===n.parts.length)return!1;for(let e of n.parts)if(void 0===e||0===Object.keys(e).length||void 0!==e.text&&""===e.text)return!1;return!0}let eC="SILENT_ERROR";class ey{constructor(e,t,n,s={}){this.model=t,this.params=n,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(!function(e){let t=!1;for(let n of e){let{role:e,parts:s}=n;if(!t&&"user"!==e)throw new K(`First content should be with role 'user', got ${e}`);if(!q.includes(e))throw new K(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(q)}`);if(!Array.isArray(s))throw new K("Content should have 'parts' property with an array of Parts");if(0===s.length)throw new K("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of s)for(let t of eg)t in e&&(o[t]+=1);let i=eE[e];for(let t of eg)if(!i.includes(t)&&o[t]>0)throw new K(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,s,o,i,a,r;let l;await this._sendPromise;let c=ef(e),d={safetySettings:null==(n=this.params)?void 0:n.safetySettings,generationConfig:null==(s=this.params)?void 0:s.generationConfig,tools:null==(o=this.params)?void 0:o.tools,toolConfig:null==(i=this.params)?void 0:i.toolConfig,systemInstruction:null==(a=this.params)?void 0:a.systemInstruction,cachedContent:null==(r=this.params)?void 0:r.cachedContent,contents:[...this._history,c]},u=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>eu(this._apiKey,this.model,d,u)).then(e=>{var t;if(em(e.response)){this._history.push(c);let n=Object.assign({parts:[],role:"model"},null==(t=e.response.candidates)?void 0:t[0].content);this._history.push(n)}else{let t=ea(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}l=e}).catch(e=>{throw this._sendPromise=Promise.resolve(),e}),await this._sendPromise,l}async sendMessageStream(e,t={}){var n,s,o,i,a,r;await this._sendPromise;let l=ef(e),c={safetySettings:null==(n=this.params)?void 0:n.safetySettings,generationConfig:null==(s=this.params)?void 0:s.generationConfig,tools:null==(o=this.params)?void 0:o.tools,toolConfig:null==(i=this.params)?void 0:i.toolConfig,systemInstruction:null==(a=this.params)?void 0:a.systemInstruction,cachedContent:null==(r=this.params)?void 0:r.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),t),u=ed(this._apiKey,this.model,c,d);return this._sendPromise=this._sendPromise.then(()=>u).catch(e=>{throw Error(eC)}).then(e=>e.response).then(e=>{if(em(e)){this._history.push(l);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=ea(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==eC&&console.error(e)}),u}}async function eO(e,t,n,s){return(await Z(t,I.COUNT_TOKENS,e,!1,JSON.stringify(n),s)).json()}async function eR(e,t,n,s){return(await Z(t,I.EMBED_CONTENT,e,!1,JSON.stringify(n),s)).json()}async function e_(e,t,n,s){let o=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await Z(t,I.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),s)).json()}class ew{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=eh(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;let s=ep(e),o=Object.assign(Object.assign({},this._requestOptions),t);return eu(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(n=this.cachedContent)?void 0:n.name},s),o)}async generateContentStream(e,t={}){var n;let s=ep(e),o=Object.assign(Object.assign({},this._requestOptions),t);return ed(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(n=this.cachedContent)?void 0:n.name},s),o)}startChat(e){var t;return new ey(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(t=this.cachedContent)?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let n=function(e,t){var n;let s={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null==(n=null==t?void 0:t.cachedContent)?void 0:n.name,contents:[]},o=null!=e.generateContentRequest;if(e.contents){if(o)throw new X("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(o)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{let t=ef(e);s.contents=[t]}return{generateContentRequest:s}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return eO(this.apiKey,this.model,n,s)}async embedContent(e,t={}){let n="string"==typeof e||Array.isArray(e)?{content:ef(e)}:e,s=Object.assign(Object.assign({},this._requestOptions),t);return eR(this.apiKey,this.model,n,s)}async batchEmbedContents(e,t={}){let n=Object.assign(Object.assign({},this._requestOptions),t);return e_(this.apiKey,this.model,e,n)}}var eI=e.i(62294),eA=e.i(32407),eT=e.i(31810),ev=e.i(56035),eN=e.i(33365),eS=e.i(19290),eb=e.i(17462),eD=e.i(49597),eM=e.i(14333);let ex=new class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new K("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new ew(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new X("Cached content must contain a `name` field.");if(!e.model)throw new X("Cached content must contain a `model` field.");for(let n of["model","systemInstruction"])if((null==t?void 0:t[n])&&e[n]&&(null==t?void 0:t[n])!==e[n]){if("model"===n&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new X(`Different value for "${n}" specified in modelParams (${t[n]}) and cachedContent (${e[n]})`)}let s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new ew(this.apiKey,s,n)}}(process.env.GEMINI_API_KEY),eU=new Map,eP=new Map,e$=0;async function eG(e){return console.log(`[DEBUG] Delaying for ${e}ms...`),new Promise(t=>setTimeout(t,e))}async function eH(){console.log("[DEBUG] Connecting to DB and fetching portfolio data..."),await (0,eI.default)();let[e,t,n,s,o,i,a,r]=await Promise.all([eA.default.findOne({}),eT.default.find({}),ev.default.find({}).sort({order:1}),eN.default.find({}).sort({order:1}),eS.default.find({}).sort({order:1}),eb.default.find({}).sort({order:1}),eD.default.find({}).sort({order:1}),eM.default.findOne({})]);return console.log("[DEBUG] Portfolio data fetched successfully."),JSON.stringify({profile:e,skills:t,experiences:n,projects:s,education:o,trainings:i,achievements:a,additional:r})}async function eL(e,t,n=2){let s;console.log(`[DEBUG] Attempting to generate content with prompt (first 100 chars): "${t.substring(0,100)}..."`);for(let o=0;o<n;o++)try{console.log(`[DEBUG] AI generation attempt ${o+1}/${n}...`);let s=await e.generateContent(t),i=(await s.response).text();return console.log(`[DEBUG] AI generation successful on attempt ${o+1}. Response (first 100 chars): "${i.substring(0,100)}..."`),i}catch(e){if(s=e,console.error(`[DEBUG] AI generation attempt ${o+1} failed:`,e),e.message?.includes("quota")||e.message?.includes("Quota exceeded"))throw console.error("[DEBUG] QUOTA_EXCEEDED error detected."),Error("QUOTA_EXCEEDED");if(503===e.status&&o<n-1){let e=1e3*Math.pow(2,o);console.log(`[DEBUG] Attempt ${o+1} failed with 503. Retrying in ${e}ms...`),await eG(e)}else if(o<n-1)console.log(`[DEBUG] Attempt ${o+1} failed. Retrying in 1000ms for other error...`),await eG(1e3);else throw console.error(`[DEBUG] All ${n} AI generation attempts failed. Re-throwing error.`),e}throw s}async function eB(t){let n="";try{let e,i;if(!(n=(await t.json()).message)||"string"!=typeof n)return k.NextResponse.json({error:"Message is required and must be a string"},{status:400});let a=(e=t.headers.get("x-forwarded-for")?.split(",")[0]||t.headers.get("x-real-ip")||"unknown",console.log(`[DEBUG] Client IP identified: ${e}`),e),r=function(e){let t=Date.now(),n=(eP.get(e)||[]).filter(e=>t-e<6e4);if(n.length>=10){let s=Math.ceil((Math.min(...n)+6e4-t)/1e3);return console.log(`[DEBUG] IP ${e} rate limited: Too many requests. Retry after ${s}s.`),{limited:!0,retryAfter:s}}if(t-e$<3e3){let n=Math.ceil((e$+3e3-t)/1e3);return console.log(`[DEBUG] IP ${e} rate limited: Cooldown period. Retry after ${n}s.`),{limited:!0,retryAfter:n}}return n.push(t),eP.set(e,n),e$=t,console.log(`[DEBUG] IP ${e} not rate limited. Current requests in window: ${n.length}`),{limited:!1}}(a);if(r.limited)return k.NextResponse.json({error:`Please wait ${r.retryAfter} seconds before sending another message.`,retryAfter:r.retryAfter},{status:429});let l=(s=n,(i=eU.get(s.toLowerCase().trim()))&&Date.now()-i.timestamp<3e5?(console.log(`[DEBUG] Cache hit for message: "${s.substring(0,50)}..."`),i.response):(i?(eU.delete(s.toLowerCase().trim()),console.log(`[DEBUG] Cache expired for message: "${s.substring(0,50)}..."`)):console.log(`[DEBUG] Cache miss for message: "${s.substring(0,50)}..."`),null));if(l)return k.NextResponse.json({reply:l,cached:!0});let c=await eH(),d=ex.getGenerativeModel({model:"gemini-2.5-flash"}),u=`Answer the user's question using ONLY the information provided in Sunni Kumar's portfolio data.

    If the user asks about something not included in the portfolio data, respond by gently guiding them back to topics about Sunni (e.g., "I might not have info on that, but I can tell you more about Sunni if you'd like!").

    Do NOT fabricate information about Sunni; ensure your response is always aligned with the portfolio data.

    Portfolio data:
    ${c}

    User question: "${n}"

    Your answer:`,h=await eL(d,u);var s,o=n;if(eU.size>=100){let e=eU.keys().next().value;e&&(eU.delete(e),console.log(`[DEBUG] Cache full, removed oldest entry: "${e.substring(0,50)}..."`))}return eU.set(o.toLowerCase().trim(),{response:h,timestamp:Date.now()}),console.log(`[DEBUG] Response cached for message: "${o.substring(0,50)}..."`),k.NextResponse.json({reply:h})}catch(t){if(console.error("Error in chat API:",t),"QUOTA_EXCEEDED"===t.message||t.message?.includes("quota")||429===t.status||503===t.status){console.log("Quota/Rate limit hit - serving fallback response");let{getFallbackResponse:t}=await e.A(11881),s=t(n);return k.NextResponse.json({reply:`${s}

---

*âš¡ Quick Response Mode: AI service is currently busy, serving offline data.*`,fallback:!0})}return k.NextResponse.json({error:"An error occurred while processing your request. Please try again later."},{status:t.status||500})}}e.s(["POST",()=>eB],76021);var eF=e.i(76021);let ej=new A.AppRouteRouteModule({definition:{kind:T.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/chat/route.ts",nextConfigOutput:"",userland:eF}),{workAsyncStorage:ek,workUnitAsyncStorage:eq,serverHooks:eK}=ej;function eY(){return(0,v.patchFetch)({workAsyncStorage:ek,workUnitAsyncStorage:eq})}async function eV(e,t,n){ej.isDev&&(0,N.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let s="/api/chat/route";s=s.replace(/\/index$/,"")||"/";let o=await ej.prepare(e,t,{srcPage:s,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:i,params:a,nextConfig:r,parsedUrl:l,isDraftMode:c,prerenderManifest:d,routerServerContext:u,isOnDemandRevalidate:h,revalidateOnlyGenerated:f,resolvedPathname:p,clientReferenceManifest:g,serverActionsManifest:E}=o,m=(0,M.normalizeAppPath)(s),C=!!(d.dynamicRoutes[m]||d.routes[p]),y=async()=>((null==u?void 0:u.render404)?await u.render404(e,t,l,!1):t.end("This page could not be found"),null);if(C&&!c){let e=!!d.routes[p],t=d.dynamicRoutes[m];if(t&&!1===t.fallback&&!e){if(r.experimental.adapterPath)return await y();throw new F.NoFallbackError}}let O=null;!C||ej.isDev||c||(O="/index"===(O=p)?"/":O);let R=!0===ej.isDev||!C,_=C&&!R;E&&g&&(0,b.setReferenceManifestsSingleton)({page:s,clientReferenceManifest:g,serverActionsManifest:E,serverModuleMap:(0,D.createServerModuleMap)({serverActionsManifest:E})});let w=e.method||"GET",I=(0,S.getTracer)(),A=I.getActiveScopeSpan(),v={params:a,prerenderManifest:d,renderOpts:{experimental:{authInterrupts:!!r.experimental.authInterrupts},cacheComponents:!!r.cacheComponents,supportsDynamicResponse:R,incrementalCache:(0,N.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:r.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,s)=>ej.onRequestError(e,t,s,u)},sharedContext:{buildId:i}},k=new x.NodeNextRequest(e),q=new x.NodeNextResponse(t),K=U.NextRequestAdapter.fromNodeNextRequest(k,(0,U.signalFromNodeResponse)(t));try{let o=async e=>ej.handle(K,v).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=I.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==P.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=n.get("next.route");if(o){let t=`${w} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${w} ${s}`)}),i=!!(0,N.getRequestMeta)(e,"minimalMode"),a=async a=>{var l,p;let g=async({previousCacheEntry:r})=>{try{if(!i&&h&&f&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(a);e.fetchMetrics=v.renderOpts.fetchMetrics;let l=v.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let c=v.renderOpts.collectedTags;if(!C)return await (0,G.sendResponse)(k,q,s,v.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,H.toNodeOutgoingHttpHeaders)(s.headers);c&&(t[B.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==v.renderOpts.collectedRevalidate&&!(v.renderOpts.collectedRevalidate>=B.INFINITE_CACHE)&&v.renderOpts.collectedRevalidate,o=void 0===v.renderOpts.collectedExpire||v.renderOpts.collectedExpire>=B.INFINITE_CACHE?void 0:v.renderOpts.collectedExpire;return{value:{kind:j.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:o}}}}catch(t){throw(null==r?void 0:r.isStale)&&await ej.onRequestError(e,t,{routerKind:"App Router",routePath:s,routeType:"route",revalidateReason:(0,$.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:h})},u),t}},E=await ej.handleResponse({req:e,nextConfig:r,cacheKey:O,routeKind:T.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:d,isRoutePPREnabled:!1,isOnDemandRevalidate:h,revalidateOnlyGenerated:f,responseGenerator:g,waitUntil:n.waitUntil,isMinimalMode:i});if(!C)return null;if((null==E||null==(l=E.value)?void 0:l.kind)!==j.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==E||null==(p=E.value)?void 0:p.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",h?"REVALIDATED":E.isMiss?"MISS":E.isStale?"STALE":"HIT"),c&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,H.fromNodeOutgoingHttpHeaders)(E.value.headers);return i&&C||m.delete(B.NEXT_CACHE_TAGS_HEADER),!E.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,L.getCacheControlHeader)(E.cacheControl)),await (0,G.sendResponse)(k,q,new Response(E.value.body,{headers:m,status:E.value.status||200})),null};A?await a(A):await I.withPropagatedContext(e.headers,()=>I.trace(P.BaseServerSpan.handleRequest,{spanName:`${w} ${s}`,kind:S.SpanKind.SERVER,attributes:{"http.method":w,"http.target":e.url}},a))}catch(t){if(t instanceof F.NoFallbackError||await ej.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,$.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:h})}),C)throw t;return await (0,G.sendResponse)(k,q,new Response(null,{status:500})),null}}e.s(["handler",()=>eV,"patchFetch",()=>eY,"routeModule",()=>ej,"serverHooks",()=>eK,"workAsyncStorage",()=>ek,"workUnitAsyncStorage",()=>eq],61378)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_371d0bff.js.map