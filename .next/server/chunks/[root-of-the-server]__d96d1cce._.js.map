{"version":3,"sources":["../../../lib/db.ts"],"sourcesContent":["\nimport mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb+srv://bytebuddy:MwIIVJzvrcFnTwnn@cluster0.mqbsh6f.mongodb.net/portfolio';\n\nif (!MONGODB_URI) {\n  throw new Error('Please define the MONGODB_URI environment variable');\n}\n\ndeclare global {\n  var mongoose: any;\n}\n\nlet cached = global.mongoose || { conn: null, promise: null };\n\nasync function dbConnect() {\n  if (cached.conn) {\n    console.log('Using existing database connection');\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    console.log('Creating new database connection to:', MONGODB_URI);\n    cached.promise = mongoose.connect(MONGODB_URI, opts)\n      .then((mongoose) => {\n        console.log('Database connected successfully');\n        return mongoose;\n      })\n      .catch((error) => {\n        console.error('Database connection error:', error);\n        // Return a mock connection in development to prevent app from crashing\n        if (process.env.NODE_ENV === 'development') {\n          console.warn('Using mock database connection in development mode');\n          return { connection: { readyState: 1 } };\n        }\n        throw error;\n      });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n    return cached.conn;\n  } catch (e) {\n    console.error('Database connection failed:', e);\n    cached.promise = null;\n    // In development, return a mock connection to prevent app from crashing\n    if (process.env.NODE_ENV === 'development') {\n      console.warn('Using mock database connection in development mode');\n      return { connection: { readyState: 1 } };\n    }\n    throw e;\n  }\n}\n\nexport default dbConnect;\n"],"names":[],"mappings":"sjCACA,IAAA,EAAA,EAAA,CAAA,CAAA,OAEA,IAAM,EAAc,QAAQ,GAAG,CAAC,WAAW,EAAI,kFAU3C,EAAS,OAAO,QAAQ,EAAI,CAAE,KAAM,KAAM,QAAS,IAAK,EAE5D,eAAe,IACb,GAAI,EAAO,IAAI,CAEb,CAFe,MACf,QAAQ,GAAG,CAAC,sCACL,EAAO,IAAI,CAGf,EAAO,OAAO,EAAE,CAKnB,QAAQ,GAAG,CAAC,uCAAwC,GACpD,EAAO,OAAO,CAAG,EAAA,OAAQ,CAAC,OAAO,CAAC,EALrB,CACX,UAI6C,MAJ7B,CAClB,GAIG,IAAI,CAAC,AAAC,IACL,QAAQ,GAAG,CAAC,mCACL,IAER,KAAK,CAAC,AAAC,IAON,MANA,QAAQ,KAAK,CAAC,6BAA8B,GAMtC,CACR,IAGJ,GAAI,CAEF,OADA,EAAO,IAAI,CAAG,MAAM,EAAO,OAAO,CAC3B,EAAO,IAAI,AACpB,CAAE,MAAO,EAAG,CAQV,MAPA,QAAQ,KAAK,CAAC,8BAA+B,GAC7C,EAAO,OAAO,CAAG,KAMX,CACR,CACF,kBAEe"}