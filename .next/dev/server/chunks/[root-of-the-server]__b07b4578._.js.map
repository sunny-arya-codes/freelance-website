{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/code/sunni-kumar/lib/db.ts"],"sourcesContent":["\nimport mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb+srv://bytebuddy:MwIIVJzvrcFnTwnn@cluster0.mqbsh6f.mongodb.net/portfolio';\n\nif (!MONGODB_URI) {\n  throw new Error('Please define the MONGODB_URI environment variable');\n}\n\ndeclare global {\n  var mongoose: any;\n}\n\nlet cached = global.mongoose || { conn: null, promise: null };\n\nasync function dbConnect() {\n  if (cached.conn) {\n    console.log('Using existing database connection');\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    console.log('Creating new database connection to:', MONGODB_URI);\n    cached.promise = mongoose.connect(MONGODB_URI, opts)\n      .then((mongoose) => {\n        console.log('Database connected successfully');\n        return mongoose;\n      })\n      .catch((error) => {\n        console.error('Database connection error:', error);\n        // Return a mock connection in development to prevent app from crashing\n        if (process.env.NODE_ENV === 'development') {\n          console.warn('Using mock database connection in development mode');\n          return { connection: { readyState: 1 } };\n        }\n        throw error;\n      });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n    return cached.conn;\n  } catch (e) {\n    console.error('Database connection failed:', e);\n    cached.promise = null;\n    // In development, return a mock connection to prevent app from crashing\n    if (process.env.NODE_ENV === 'development') {\n      console.warn('Using mock database connection in development mode');\n      return { connection: { readyState: 1 } };\n    }\n    throw e;\n  }\n}\n\nexport default dbConnect;\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE/C;;AAQA,IAAI,SAAS,OAAO,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE5D,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,QAAQ,GAAG,CAAC;QACZ,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,QAAQ,GAAG,CAAC,wCAAwC;QACpD,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAC5C,IAAI,CAAC,CAAC;YACL,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT,GACC,KAAK,CAAC,CAAC;YACN,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,uEAAuE;YACvE,wCAA4C;gBAC1C,QAAQ,IAAI,CAAC;gBACb,OAAO;oBAAE,YAAY;wBAAE,YAAY;oBAAE;gBAAE;YACzC;;;QAEF;IACJ;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;QAClC,OAAO,OAAO,IAAI;IACpB,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,OAAO,GAAG;QACjB,wEAAwE;QACxE,wCAA4C;YAC1C,QAAQ,IAAI,CAAC;YACb,OAAO;gBAAE,YAAY;oBAAE,YAAY;gBAAE;YAAE;QACzC;;;IAEF;AACF;uCAEe"}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/code/sunni-kumar/models/profile.ts"],"sourcesContent":["\nimport mongoose, { Schema, models } from 'mongoose';\n\nconst profileSchema = new Schema({\n  name: { type: String, required: true },\n  title: { type: String, required: true },\n  location: { type: String, required: true },\n  contact: {\n    email: { type: String, required: true },\n    phone: { type: String, required: true },\n    linkedin: { type: String, required: true },\n    github: { type: String, required: true },\n    portfolio: { type: String, required: true },\n  },\n  summary: { type: String, required: true },\n  image: { type: String }, // Base64 encoded image\n  imageType: { type: String }, // MIME type (e.g., 'image/jpeg', 'image/png')\n}, { timestamps: true });\n\nconst Profile = models.Profile || mongoose.model('Profile', profileSchema);\n\nexport default Profile;\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,gBAAgB,IAAI,mHAAM,CAAC;IAC/B,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,SAAS;QACP,OAAO;YAAE,MAAM;YAAQ,UAAU;QAAK;QACtC,OAAO;YAAE,MAAM;YAAQ,UAAU;QAAK;QACtC,UAAU;YAAE,MAAM;YAAQ,UAAU;QAAK;QACzC,QAAQ;YAAE,MAAM;YAAQ,UAAU;QAAK;QACvC,WAAW;YAAE,MAAM;YAAQ,UAAU;QAAK;IAC5C;IACA,SAAS;QAAE,MAAM;QAAQ,UAAU;IAAK;IACxC,OAAO;QAAE,MAAM;IAAO;IACtB,WAAW;QAAE,MAAM;IAAO;AAC5B,GAAG;IAAE,YAAY;AAAK;AAEtB,MAAM,UAAU,mHAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAC,WAAW;uCAE7C"}},
    {"offset": {"line": 177, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/code/sunni-kumar/models/skill.ts"],"sourcesContent":["\nimport mongoose, { Schema, models } from 'mongoose';\n\nconst skillSchema = new Schema({\n  category: { type: String, required: true },\n  skills: [{ type: String, required: true }],\n});\n\nconst Skill = models.Skill || mongoose.model('Skill', skillSchema);\n\nexport default Skill;\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,cAAc,IAAI,mHAAM,CAAC;IAC7B,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,QAAQ;QAAC;YAAE,MAAM;YAAQ,UAAU;QAAK;KAAE;AAC5C;AAEA,MAAM,QAAQ,mHAAM,CAAC,KAAK,IAAI,oHAAQ,CAAC,KAAK,CAAC,SAAS;uCAEvC"}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/code/sunni-kumar/models/experience.ts"],"sourcesContent":["\nimport mongoose, { Schema, models } from 'mongoose';\n\nconst experienceSchema = new Schema({\n  title: { type: String, required: true },\n  company: { type: String, required: true },\n  company_website: { type: String },\n  location: { type: String, required: true },\n  start_date: { type: String, required: true },\n  end_date: { type: String },\n  responsibilities: [{ type: String, required: true }],\n  tech_stack: [{ type: String, required: true }],\n  order: { type: Number, required: true },\n  image: { type: String },\n  imageType: { type: String },\n}, { timestamps: true });\n\nconst Experience = models.Experience || mongoose.model('Experience', experienceSchema);\n\nexport default Experience;\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,mBAAmB,IAAI,mHAAM,CAAC;IAClC,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,SAAS;QAAE,MAAM;QAAQ,UAAU;IAAK;IACxC,iBAAiB;QAAE,MAAM;IAAO;IAChC,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,YAAY;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC3C,UAAU;QAAE,MAAM;IAAO;IACzB,kBAAkB;QAAC;YAAE,MAAM;YAAQ,UAAU;QAAK;KAAE;IACpD,YAAY;QAAC;YAAE,MAAM;YAAQ,UAAU;QAAK;KAAE;IAC9C,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,OAAO;QAAE,MAAM;IAAO;IACtB,WAAW;QAAE,MAAM;IAAO;AAC5B,GAAG;IAAE,YAAY;AAAK;AAEtB,MAAM,aAAa,mHAAM,CAAC,UAAU,IAAI,oHAAQ,CAAC,KAAK,CAAC,cAAc;uCAEtD"}},
    {"offset": {"line": 261, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/code/sunni-kumar/models/project.ts"],"sourcesContent":["\nimport mongoose, { Schema, models } from 'mongoose';\n\nconst projectSchema = new Schema({\n  name: { type: String, required: true },\n  type: { type: String, required: true },\n  repo_url: { type: String },\n  notebook_url: { type: String },\n  description: { type: String, required: true },\n  tech_stack: [{ type: String, required: true }],\n  order: { type: Number, required: true },\n  image: { type: String }, // Base64 encoded image\n  imageType: { type: String }, // MIME type\n}, { timestamps: true });\n\nconst Project = models.Project || mongoose.model('Project', projectSchema);\n\nexport default Project;\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,gBAAgB,IAAI,mHAAM,CAAC;IAC/B,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,UAAU;QAAE,MAAM;IAAO;IACzB,cAAc;QAAE,MAAM;IAAO;IAC7B,aAAa;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC5C,YAAY;QAAC;YAAE,MAAM;YAAQ,UAAU;QAAK;KAAE;IAC9C,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,OAAO;QAAE,MAAM;IAAO;IACtB,WAAW;QAAE,MAAM;IAAO;AAC5B,GAAG;IAAE,YAAY;AAAK;AAEtB,MAAM,UAAU,mHAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAC,WAAW;uCAE7C"}},
    {"offset": {"line": 311, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/code/sunni-kumar/models/education.ts"],"sourcesContent":["\nimport mongoose, { Schema, models } from 'mongoose';\n\nconst educationSchema = new Schema({\n  institution: { type: String, required: true },\n  program: { type: String, required: true },\n  cgpa: { type: String },\n  start_date: { type: String, required: true },\n  end_date: { type: String, required: true },\n  portal_url: { type: String },\n  relevant_coursework: [{ type: String }],\n  percentage: { type: String },\n  year_of_completion: { type: String },\n  location: { type: String },\n  order: { type: Number, required: true },\n  image: { type: String },\n  imageType: { type: String },\n}, { timestamps: true });\n\nconst Education = models.Education || mongoose.model('Education', educationSchema);\n\nexport default Education;\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,kBAAkB,IAAI,mHAAM,CAAC;IACjC,aAAa;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC5C,SAAS;QAAE,MAAM;QAAQ,UAAU;IAAK;IACxC,MAAM;QAAE,MAAM;IAAO;IACrB,YAAY;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC3C,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,YAAY;QAAE,MAAM;IAAO;IAC3B,qBAAqB;QAAC;YAAE,MAAM;QAAO;KAAE;IACvC,YAAY;QAAE,MAAM;IAAO;IAC3B,oBAAoB;QAAE,MAAM;IAAO;IACnC,UAAU;QAAE,MAAM;IAAO;IACzB,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,OAAO;QAAE,MAAM;IAAO;IACtB,WAAW;QAAE,MAAM;IAAO;AAC5B,GAAG;IAAE,YAAY;AAAK;AAEtB,MAAM,YAAY,mHAAM,CAAC,SAAS,IAAI,oHAAQ,CAAC,KAAK,CAAC,aAAa;uCAEnD"}},
    {"offset": {"line": 373, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/code/sunni-kumar/models/training.ts"],"sourcesContent":["\nimport mongoose, { Schema, models } from 'mongoose';\n\nconst trainingSchema = new Schema({\n  name: { type: String, required: true },\n  provider: { type: String, required: true },\n  start_date: { type: String, required: true },\n  end_date: { type: String, required: true },\n  certificate_url: { type: String },\n  order: { type: Number, required: true },\n  image: { type: String },\n  imageType: { type: String },\n}, { timestamps: true });\n\nconst Training = models.Training || mongoose.model('Training', trainingSchema);\n\nexport default Training;\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,iBAAiB,IAAI,mHAAM,CAAC;IAChC,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,YAAY;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC3C,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,iBAAiB;QAAE,MAAM;IAAO;IAChC,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,OAAO;QAAE,MAAM;IAAO;IACtB,WAAW;QAAE,MAAM;IAAO;AAC5B,GAAG;IAAE,YAAY;AAAK;AAEtB,MAAM,WAAW,mHAAM,CAAC,QAAQ,IAAI,oHAAQ,CAAC,KAAK,CAAC,YAAY;uCAEhD"}},
    {"offset": {"line": 418, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/code/sunni-kumar/models/achievement.ts"],"sourcesContent":["\nimport mongoose, { Schema, models } from 'mongoose';\n\nconst achievementSchema = new Schema({\n  title: { type: String, required: true },\n  description: { type: String, required: true },\n  badge_url: { type: String },\n  certificate_url: { type: String },\n  event: { type: String },\n  order: { type: Number, required: true },\n  image: { type: String },\n  imageType: { type: String },\n}, { timestamps: true });\n\nconst Achievement = models.Achievement || mongoose.model('Achievement', achievementSchema);\n\nexport default Achievement;\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,oBAAoB,IAAI,mHAAM,CAAC;IACnC,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,aAAa;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC5C,WAAW;QAAE,MAAM;IAAO;IAC1B,iBAAiB;QAAE,MAAM;IAAO;IAChC,OAAO;QAAE,MAAM;IAAO;IACtB,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,OAAO;QAAE,MAAM;IAAO;IACtB,WAAW;QAAE,MAAM;IAAO;AAC5B,GAAG;IAAE,YAAY;AAAK;AAEtB,MAAM,cAAc,mHAAM,CAAC,WAAW,IAAI,oHAAQ,CAAC,KAAK,CAAC,eAAe;uCAEzD"}},
    {"offset": {"line": 461, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/code/sunni-kumar/models/additional.ts"],"sourcesContent":["\nimport mongoose, { Schema, models } from 'mongoose';\n\nconst additionalSchema = new Schema({\n  languages: [{ type: String, required: true }],\n  hobbies: [{ type: String, required: true }],\n});\n\nconst Additional = models.Additional || mongoose.model('Additional', additionalSchema);\n\nexport default Additional;\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,mBAAmB,IAAI,mHAAM,CAAC;IAClC,WAAW;QAAC;YAAE,MAAM;YAAQ,UAAU;QAAK;KAAE;IAC7C,SAAS;QAAC;YAAE,MAAM;YAAQ,UAAU;QAAK;KAAE;AAC7C;AAEA,MAAM,aAAa,mHAAM,CAAC,UAAU,IAAI,oHAAQ,CAAC,KAAK,CAAC,cAAc;uCAEtD"}},
    {"offset": {"line": 487, "column": 0}, "map": {"version":3,"sources":["file:///home/sunny/code/sunni-kumar/app/api/chat/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport OpenAI from 'openai';\nimport dbConnect from '@/lib/db';\nimport Profile from '@/models/profile';\nimport Skill from '@/models/skill';\nimport Experience from '@/models/experience';\nimport Project from '@/models/project';\nimport Education from '@/models/education';\nimport Training from '@/models/training';\nimport Achievement from '@/models/achievement';\nimport Additional from '@/models/additional';\n\n// Initialize OpenAI client\nconst client = new OpenAI({\n  baseURL: \"https://integrate.api.nvidia.com/v1\",\n  apiKey: \"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\",\n  dangerouslyAllowBrowser: true // Just in case, though this is server-side\n});\n\n// Ensure we don't accidentally pick up local env vars if they exist\ndelete process.env.OPENAI_BASE_URL;\ndelete process.env.OPENAI_API_KEY;\n\nconst MAX_RETRIES = 2;\nconst INITIAL_DELAY_MS = 1000;\n\n// Rate limiting configuration\nconst RATE_LIMIT_WINDOW_MS = 60 * 1000;\nconst MAX_REQUESTS_PER_WINDOW = 10;\nconst REQUEST_COOLDOWN_MS = 3000;\n\n\n\n// Track requests\nconst requestTracker = new Map<string, number[]>();\nlet lastRequestTime = 0;\n\nfunction getClientIP(req: NextRequest): string {\n  return req.headers.get('x-forwarded-for')?.split(',')[0] ||\n    req.headers.get('x-real-ip') ||\n    'unknown';\n}\n\nfunction isRateLimited(ip: string): { limited: boolean; retryAfter?: number } {\n  const now = Date.now();\n  const requests = requestTracker.get(ip) || [];\n  const recentRequests = requests.filter(time => now - time < RATE_LIMIT_WINDOW_MS);\n\n  if (recentRequests.length >= MAX_REQUESTS_PER_WINDOW) {\n    const oldestRequest = Math.min(...recentRequests);\n    const retryAfter = Math.ceil((oldestRequest + RATE_LIMIT_WINDOW_MS - now) / 1000);\n    return { limited: true, retryAfter };\n  }\n\n  if (now - lastRequestTime < REQUEST_COOLDOWN_MS) {\n    const retryAfter = Math.ceil((lastRequestTime + REQUEST_COOLDOWN_MS - now) / 1000);\n    return { limited: true, retryAfter };\n  }\n\n  recentRequests.push(now);\n  requestTracker.set(ip, recentRequests);\n  lastRequestTime = now;\n  return { limited: false };\n}\n\n\n\nasync function getPortfolioData() {\n  await dbConnect();\n\n  // Fetch data using lean() if available for better performance, \n  // or standard find() if not. We use Promise.all for speed.\n  const [\n    profile,\n    skills,\n    experiences,\n    projects,\n    education,\n    trainings,\n    achievements,\n    additional\n  ] = await Promise.all([\n    Profile.findOne({}).lean().exec().catch(() => Profile.findOne({})),\n    Skill.find({}).lean().exec().catch(() => Skill.find({})),\n    Experience.find({}).sort({ order: 1 }).lean().exec().catch(() => Experience.find({}).sort({ order: 1 })),\n    Project.find({}).sort({ order: 1 }).lean().exec().catch(() => Project.find({}).sort({ order: 1 })),\n    Education.find({}).sort({ order: 1 }).lean().exec().catch(() => Education.find({}).sort({ order: 1 })),\n    Training.find({}).sort({ order: 1 }).lean().exec().catch(() => Training.find({}).sort({ order: 1 })),\n    Achievement.find({}).sort({ order: 1 }).lean().exec().catch(() => Achievement.find({}).sort({ order: 1 })),\n    Additional.findOne({}).lean().exec().catch(() => Additional.findOne({})),\n  ]);\n\n  // Structure data cleanly to minimize token usage\n  const data = {\n    profile,\n    skills: skills?.map((s: any) => ({ name: s.name, category: s.category, level: s.level })),\n    experiences: experiences?.map((e: any) => ({ role: e.role, company: e.company, duration: e.duration, description: e.description })),\n    projects: projects?.map((p: any) => ({ title: p.title, description: p.description, techStack: p.techStack })),\n    education,\n    trainings,\n    achievements,\n    additional,\n  };\n  return JSON.stringify(data);\n}\n\nasync function generateContentWithRetry(systemContext: string, userMessage: string, retries = MAX_RETRIES) {\n  for (let attempt = 0; attempt < retries; attempt++) {\n    try {\n      console.log(`[DEBUG] AI generation attempt ${attempt + 1}/${retries}...`);\n\n      // CRITICAL FIX: Changed stream: true to stream: false\n      // Your frontend awaits the full JSON response, so streaming internally \n      // adds complexity and risk of dropped connections without benefit.\n      const completion = await client.chat.completions.create({\n        model: \"openai/gpt-oss-120b\",\n        messages: [\n          { role: \"system\", content: systemContext },\n          { role: \"user\", content: userMessage }\n        ],\n        temperature: 0.6,\n        top_p: 1,\n        max_tokens: 4096,\n        stream: false\n      });\n      console.log(completion);\n\n      // Check for error in response object (if client doesn't throw)\n      if ((completion as any).error) {\n        throw new Error(`API Error: ${(completion as any).error}`);\n      }\n\n      // Handle response extraction safely\n      if (!completion.choices || completion.choices.length === 0) {\n        throw new Error('Empty response structure from API');\n      }\n\n      const choice = completion.choices[0];\n      if (!choice || !choice.message) {\n        throw new Error('Empty response structure from API');\n      }\n\n      // DeepSeek/NVIDIA models sometimes put reasoning in a separate field\n      const message = choice.message as any;\n      let text = \"\";\n\n      // Include reasoning if available (often valuable for this model)\n      if (message.reasoning_content) {\n        text += message.reasoning_content + \"\\n\\n\";\n      }\n\n      if (message.content) {\n        text += message.content;\n      }\n\n      if (!text) {\n        throw new Error('No content received in response');\n      }\n\n      console.log(`[DEBUG] AI generation successful. Length: ${text.length}`);\n      return text;\n\n    } catch (error: any) {\n      console.error(`[DEBUG] AI generation attempt ${attempt + 1} failed:`, error.message);\n\n      if (attempt < retries - 1) {\n        const delayMs = INITIAL_DELAY_MS * Math.pow(2, attempt);\n        await new Promise(resolve => setTimeout(resolve, delayMs));\n      } else {\n        throw error;\n      }\n    }\n  }\n  throw new Error(\"Failed to generate content after retries\");\n}\n\nexport async function POST(req: NextRequest) {\n  let message = \"\";\n  try {\n    const body = await req.json();\n    message = body.message;\n\n    if (!message || typeof message !== 'string') {\n      return NextResponse.json({ error: 'Invalid message' }, { status: 400 });\n    }\n\n    const clientIP = getClientIP(req);\n    const rateLimit = isRateLimited(clientIP);\n\n    if (rateLimit.limited) {\n      return NextResponse.json(\n        { error: `Rate limit exceeded. Retry in ${rateLimit.retryAfter}s.`, retryAfter: rateLimit.retryAfter },\n        { status: 429 }\n      );\n    }\n\n\n\n    const portfolioData = await getPortfolioData();\n\n    // Construct clear instructions\n    const systemContext = `You are an AI assistant for Sunni Kumar. Answer questions using ONLY the provided portfolio data.\n    \n    Guidelines:\n    - Be friendly and professional.\n    - If the answer isn't in the data, politely say you don't know but can discuss Sunni's known skills.\n    - Keep answers concise unless asked for details.\n    \n    Portfolio Data:\n    ${portfolioData}`;\n\n    const text = await generateContentWithRetry(systemContext, message);\n\n    return NextResponse.json({ reply: text });\n\n  } catch (error: any) {\n    console.error('Chat API Error:', error);\n\n    // Fallback Logic\n    try {\n      // Safe re-read or default\n      const fallbackMessage = message || \"\";\n\n      const { getFallbackResponse } = await import('@/lib/fallback-responses');\n      const fallbackReply = getFallbackResponse(fallbackMessage);\n\n      return NextResponse.json({\n        reply: `${fallbackReply}\\n\\n---\\n\\n*âš¡ Quick Response Mode: AI service is currently busy, serving offline data.*`,\n        fallback: true\n      });\n    } catch (e) {\n      return NextResponse.json(\n        { error: 'Service temporarily unavailable.' },\n        { status: 503 }\n      );\n    }\n  }\n}"],"names":[],"mappings":"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"}}]
}